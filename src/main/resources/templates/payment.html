<!DOCTYPE html>
<html lang="en" >
<head>
    <!-- jQuery -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js" ></script>
    <!-- iamport.payment.js -->
    <script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js"></script>
    <script th:inline="javascript">

        var IMP = window.IMP;
        IMP.init("imp07703887");
        function requestPay() {

            var ticketUid = '[[${requestDto.ticketUid}]]';
            var gameName = '[[${requestDto.gameName}]]';
            var price = '[[${requestDto.price}]]';
            var userName = '[[${requestDto.userName}]]';
            var userEmail = '[[${requestDto.userEmail}]]';
            var userAddress = '[[${requestDto.userAddress}]]';

            IMP.request_pay(
                {
                    pg: "kakaopay.TC0ONETIME",
                    pay_method: "card",
                    merchant_uid: ticketUid,
                    name: gameName,
                    amount: price,
                    buyer_email: userEmail,
                    buyer_name: userName,
                    buyer_tel: '010-1234-5678',
                    buyer_addr: userAddress,
                    buyer_postcode: '123-456',
                },
                function (rsp) {
                    console.log(rsp);

                    console.log(rsp.imp_uid);

                    if(rsp.imp_uid) {
                        console.log('imp_uid 값이 있습니다');
                    } else {
                        console.log('imp_uid 값이 없습니다');
                    }
                    if(rsp.success){
                        alert("결제 완료");
                        window.location.href = "success-payment";
                    } else {
                        alert('결제 실패! ' + rsp.error_msg)
                        window.location.href = "fail-payment";
                    }
                });
        }
    </script>
    <meta charset="UTF-8">
    <title>결제 페이지</title>
</head>
<body>
<button th:with="requestDto = ${requestDto}" onclick="requestPay()">결제하기</button>
</body>
</html>
